<!doctype html>
<html lang="en">
<head>
    <title>SmartMenu - Menu Setting</title>
    <meta charset="utf-8">

    <!-- bootstrap.css -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- jquery 要先放 , bs會用到-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>



    <!-- import our MenuSetting.css -->
    <link rel="stylesheet" type="text/css" href="css/MenuSetting.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">

    <script src="js/jscolor.min.js"></script>


    <meta name="viewport" content="width=device-width, initial-scale=1">





</head>




<body class="bg-1" data-spy="scroll" data-target=".navbar">

    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>                        
                </button>
                <a class="navbar-brand" href="./index.html#home">＿＿餐廳</a>
            </div>
        
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav navbar-right admin-menu">
                    <li class="active">
                        <a href="#">
                            <i class="glyphicon glyphicon-cog"></i>設定
                        </a>
                    </li>
                    
                    <li>
                        <a href="#">
                            <i class="glyphicon glyphicon-log-out"></i>登出
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <!-- 菜單設定 -->
    <div class="row" id="MenuSetting">
        <div class="col-xs-3">
            <ul class="nav nav-pills nav-stacked admin-menu" >
                <li>
                    <a href="./ProfileSetting.html">
                        <i class="glyphicon glyphicon-user"></i> 個人檔案設定
                    </a>
                </li>

                <li>
                    <a href="./CompanySetting.html">
                        <i class="glyphicon glyphicon-briefcase"></i> 公司頁面設定
                    </a>
                </li>

                <li class="active">
                    <a href="#">
                        <i class="glyphicon glyphicon-book"></i> 菜單設定
                    </a>
                </li>
            </ul>
        </div>

        <!-- 這裡開始不一樣 Menu Setting -->

        <div class="col-xs-9">
            
            <!-- <div class="col-xs-5">
                Color: <input class="jscolor" value="ffffff">
            </div>
             -->
            
            <div class="col-xs-6">
                <center>
                    <button class="btn btn-warning" onclick="SetValue();">更改</button>
                    <br><br>
                    <iframe src="../Menu/output.html" id="Source"></iframe>
                </center>
            </div>

            <div class="col-xs-6">
                <center>
                    <button class="btn btn-success">儲存</button>
                    <br><br>
                    <iframe src="../Menu/output.html" id="Edited"></iframe>
                </center>
            </div>




        </div>
    </div>

    <script type="text/javascript">


        window.onload = function()
        {
            var bar0 = $("#Source").contents().find("#FoodType0")[0].children;
            var bar0_length = bar0.length;

            if(bar0_length==0)
            {
                var Source_FoodType = $("#Source").contents().find("#FoodType0");
                var button_html = makeTypeAddButton("0");
                Source_FoodType.append(button_html);
            }

            for(var i=0;i<bar0_length;i++)
            {
                var myid = bar0[i].getAttribute("id");
                
                var a_html = makeTagA("0",
                                        "0_"+i,
                                        bar0[i].children[0].text,
                                        true);

                $("#Source").contents().find("#" + myid).html(a_html);

                if(i==bar0_length-1)
                {
                    var Source_FoodType = $("#Source").contents().find("#FoodType0");
                    var button_html = makeTypeAddButton("0");
                    Source_FoodType.append(button_html);
                }

                // 第二層

                var bar1 = $("#Source").contents().find("#FoodType0_"+i)[0].children;
                
                var bar1_length = bar1.length;

                for(var j=0;j<bar1_length;j++)
                {
                    myid = bar1[j].getAttribute("id");

                    a_html = makeTagA("0_"+i , 
                                        "0_"+i+"_"+j, 
                                        bar1[j].children[0].text,
                                        true);

                    $("#Source").contents().find("#" + myid).html(a_html);

                    if(j==bar1_length-1)
                    {
                        var Source_FoodType = $("#Source").contents().find("#FoodType0_" + i);

                        var button_html = makeTypeAddButton("0_" + i);
                        Source_FoodType.append(button_html);
                    }


                    var output = $("#Source").contents().find("#FoodTypes0_" + i + "_" + j + "_0")[0];
                    // console.log(output);
                }
            }
            $("#Source").contents().find(".navbar li a").css({"display" : "inline-block" , "width" : "calc(100% - 90px)"});
        }

        function makeEditDeleteButton(nextNum)
        {
            var myhtml = 
            '<button class="btn nothing"></button>' + 
            '<button class="btn btn-danger pull-right"' + 
            'onclick="DeleteItem(\'FoodTypes' + nextNum + '\');" >' + 
            '   <span class="glyphicon glyphicon-trash"></span>' + 
            '</button>' + 
            '<button class="btn btn-info pull-right"' + 
            'onclick="EditItem(\'FoodTypes'+ nextNum + '\');" >' + 
            '   <span class="glyphicon glyphicon-pencil"></span>' + 
            '</button>';

            return myhtml;
        }

        function makeTagA(thisNum,nextNum,mytext,withButton)
        {
            var myhtml = 
                '<a href="#" onclick = "nextPage(' + 
                    "'" + "bar" + thisNum + "'" + "," +
                    "'" + "bar" + nextNum + "'" + 
                    ");" + '" >' +
                    mytext + '</a>';

            if(withButton==true) myhtml += makeEditDeleteButton(nextNum);

            // myhtml += '</a>';

            return myhtml;
        }

        function makeTypeAddButton(thisNum)
        {
            var myhtml = 
                '<button id="TypeAddButton' + thisNum + '"' + 
                            ' class="btn btn-success form-control"' + 
                            ' onclick="AddNext('+ "'" +
                            'TypeAddButton' + thisNum + "'" + 
                            ');">新增餐點分類</button>';

            return myhtml;
        }


        function makeBar(barNum)
        {
            var myhtml = 
                '<div class="collapse navbar-collapse" id="bar' + barNum 
                    + '">' +
                    '<ul class="nav navbar-nav navbar-right" id="' +
                        "FoodType" + barNum + '">' +
                    '</ul>' + 
                '</div>';

            return myhtml;
        }


        function SetValue()
        {
            var bar0 = $("#Source").contents().find("#FoodType0")[0].children;
            var bar0_length = bar0.length - 1;

            for(var i=0;i<bar0_length;i++)
            {
                var myid = bar0[i].getAttribute("id");

                if(myid.search("TypeAddTextboxNums")>=0)
                {
                    var myNum = myid.replace("TypeAddTextboxNums","");

                    var mytext = $("#Source").contents().find("#"+myid)[0].value;
                    if(mytext.length==0) continue;

                    var TagA_withButton = makeTagA("0",
                                            myNum,
                                            mytext,
                                            true);
                    var Sourcehtml = 
                    '<li class="FoodTypes0" id="FoodTypes' + myNum + '">' + TagA_withButton + '</li>';

                    $("#Source").contents().find("#"+myid).replaceWith(Sourcehtml);
                    
                    // ---------------------------------------

                    var TagA = makeTagA("0",
                                        myNum,
                                        mytext,
                                        false);
                    var Editedhtml = 
                    '<li class="FoodTypes0" id="FoodTypes' + myNum + '">' + TagA + '</li>';

                    $("#Edited").contents().find("#FoodType0").append(Editedhtml);

                    var barNum = "0" + "_" + i;
                    var mybar = makeBar(barNum);
                    $("#Edited").contents().find(".container").append(mybar);
                        
                }

                // 第二層

                var bar1 = $("#Source").contents().find("#FoodType0_" + i)[0].children;
                
                var bar1_length = bar1.length - 1;

                for(var j=0;j<bar1_length;j++)
                {
                    var myid = bar1[j].getAttribute("id");
                    
                    if(myid.search("TypeAddTextboxNums")>=0)
                    {
                        var mytext = $("#Source").contents().find("#"+myid)[0].value;
                        if(mytext.length==0) continue;

                        var myNum = myid.replace("TypeAddTextboxNums","");

                        var TagA_withButton = makeTagA("0_" + i , 
                                        myNum ,
                                        mytext,
                                        true);

                        var Sourcehtml = '<li class="FoodTypes0_' + i + '"' +
                                    'id="FoodTypes' + myNum + '">' + TagA_withButton + '</li>';
                        $("#Source").contents().find("#" + myid).replaceWith(Sourcehtml);


                        // ---------------------------------------
                        var TagA = makeTagA("0_" + i,
                                            myNum,
                                            mytext,
                                            false);
                        var Editedhtml = 
                        '<li class="FoodTypes0_' + i + '"' +
                                    'id="FoodTypes' + myNum + '">' + TagA + '</li>';

                        $("#Edited").contents().find("#FoodType0_" + i).append(Editedhtml);


                        var barNum = "0" + "_" + i + "_" + j;
                        var mybar = makeBar(barNum);
                        $("#Edited").contents().find(".container").append(mybar);
                    
                    }
                }

            }



            $("#Source").contents().find(".navbar li a").css({"display" : "inline-block" , "width" : "calc(100% - 90px)"});
        }


    </script>


</body>


</html>